Needed Packages
```{r}
library(tidyverse)
library(kableExtra)
library(dplyr)
library(zoo)
```

```{r}
#CSV to table
#Bringing all the data sets into R.
HDItable <- read.csv("data/HDR21-22Table 1.csv", skip =6, head = TRUE)
oecdAbbreviations <- read.csv("data/oecdAbbreviations.csv")
UnemploymentTotal2021 <- read.csv(header = TRUE, skip = 3, "data/2021WorldBankUnemploymentData.csv")
UnemploymentWomen2021 <- read.csv(header = TRUE, skip = 3, "data/2021WorldBankUnemploymentDataWomen.csv")
LiteracyRate2023 <- read.csv("data/LiteracyRate2023.csv")

Literacy <- select(LiteracyRate2023, "growthRate", "country", "region", "rank", "latestRate", "dataYear", "pop2023", "landAreaKm", "density")

#found colnames function here: https://www.projectpro.io/recipes/change-column-headers-of-dataframe-r#:~:text=How%20to%20change%20column%20headers%20of%20a%20data%2Dframe%20in,can%20be%20changed%20at%20once.
colnames(HDItable) <- c("HDI rank", "Country", "Human Development Index", "Empty", "Life Expectancy at Birth (years)", "Empty", "Expected Years of Schooling")

#This is the HDItable in a nice format
HDItable <- select(HDItable, "HDI rank", "Country", "Human Development Index", "Life Expectancy at Birth (years)", "Expected Years of Schooling") %>% 
  slice(1:195) %>% 
  drop_na()

UnemploymentTotal2 <- UnemploymentTotal2021 %>%
  select(Country.Name, Country.Code, X2021) %>%
  drop_na()

UnemploymentWomen2 <- UnemploymentWomen2021 %>%
  select(Country.Name, Country.Code, X2021) %>%
  drop_na()

#Only want the two columns with country names and codes.
Abbreviations <- oecdAbbreviations %>% 
  select("CODE", "Country")

#Now I want to join the oecd abbreviations to the countries in the HDItable.
HDItable2 <- HDItable %>%
  left_join(Abbreviations, by = contains("Country", "Country"))
unmatched <- as.list(HDItable2 %>% filter(is.na(CODE)) %>% select(Country))


#This part is not working out very nicely.
HDItable3 <- HDItable2 %>%
  left_join(UnemploymentTotal2, by = c("CODE" = "Country.Code")) %>%
  left_join(UnemploymentWomen2, by = c("CODE" = "Country.Code")) %>% 
  mutate(Total = X2021.x) %>%
    select(-(`X2021.x`)) %>%
  mutate(women = X2021.y) %>%
  select(-(X2021.y)) %>%
  select(-(Country.Name.x)) %>%
  select(-(Country.Name.y)) %>%
  left_join(Literacy, by = c("Country" = "country"))
write.csv(HDItable3, "data/wrangled.csv")
```

```{r}
#SHREYA
library(readxl)
library(factoextra)
library(cluster)

#importing the dataset
GIIraw <- read_excel("data/GII.xlsx", col_names = TRUE, skip = 2)

#removing the na values plus selecting relevant columns
GII <- GIIraw %>% 
  select(...1, ...2, ...3, ...5) %>% 
  drop_na()

#renaming the columns
colnames(GII) <- c("HDI rank", "Country", "GII Value", "GII Rank")

#check the type of value for the column. apparently its charecter
class(GII$`GII Value`)
#hence converting to numeric before rounding the column
GII$`GII Value` <- as.numeric(GII$`GII Value`)
round(GII$`GII Value`, digits = 1)

HDI <- HDItable3 %>% 
  select("Country", "Human Development Index")

#joining the previously wrangled hdi values with GII valus
GIIHDI <- HDI %>% 
  left_join(GII, by = "Country")


#ELBOWPLOT
#standardising
matrix <- data.matrix(GIIHDI$`GII Value`)
matrix <- matrix[complete.cases(matrix), ]
matrix <- scale(matrix)

#clustering 
k_max <- 10
set.seed(180)
wss <- numeric(k_max)
for(k in 1:k_max) {
  km_res <- kmeans(matrix, k)
  wss[k] <- sum(km_res$withinss)
}

#plot the elbow curve
fviz_nbclust(matrix, kmeans, method = "wss", k.max = k_max, nstart = 25) +
  labs(title = "Elbow plot for GII values", x = "Number of clusters", y = "Within-cluster sum of squares") +
  geom_vline(xintercept = 3, linetype = "dashed", color = "red")


#cluster graph
# Add cluster assignment to the data frame
k_max <- 3
set.seed(180)
wss <- numeric(k_max)
for(k in 1:k_max) {
  km_res <- kmeans(matrix, k)
  wss[k] <- sum(km_res$withinss)
}

GIIHDI <- drop_na(GIIHDI)
GIIHDI$cluster <- as.factor(km_res$cluster)

# Plot the clusters
ggplot(GIIHDI, aes(x = `Human Development Index`, y = `GII Value`, color = cluster)) +
  geom_point(size = 3) +
  labs(title = "Cluster plot for GII values", x = "GII value") +
  theme_minimal()
```
```{r}
location_raw <- read.csv("data/location.csv", head = TRUE)

location <- location_raw %>% 
  select("country_code", "latitude", "longitude", "country") %>% 
  rename("Country" = "country")

GIIHDILocation <- GIIHDI %>% 
  left_join(location, by ="Country")

#cluster based on location

ggplot(GIIHDILocation, aes(x = longitude, y = latitude, fill = `HDI rank`)) +
  geom_point(alpha = 0.5)  + 
  scale_color_brewer(palette = "Set2")
```

```{r}
write.csv(GIIHDI, "GIIHDI.csv")
```


